<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PintorPro - Calculadora y Presupuestos</title>
        <!-- PWA --> 
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4fc3f7">
    
    <!-- Estilos -->
    <link rel="stylesheet" href="style.css">
    
        <!-- Icons -->
    <link rel="icon" type="image/png" href="icon-192.png">

    <!-- Librerías externas -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


</head>
<body>

    <div id="view-auth" class="view-section container">
        <div class="auth-card">
            <h1 style="color: var(--secondary-accent); margin-bottom: 10px;">PintorPro</h1>
            <p>Calculadora y Presupuestos</p>
            <br>
            <div id="login-form">
                <input type="email" id="login-email" placeholder="Correo electrónico">
                <input type="password" id="login-pass" placeholder="Contraseña">
                <button class="btn btn-primary" onclick="app.login()">Ingresar</button>
                <p style="margin-top:10px; font-size:0.8rem; text-decoration: underline;" onclick="app.forgotPassword()">Olvidé mi contraseña</p>
            </div>

            <div id="register-form" class="hidden">
                <h3>Registro de Administrador</h3>
                <input type="email" id="reg-email" placeholder="Correo electrónico">
                <input type="password" id="reg-pass" placeholder="Contraseña">
                <button class="btn btn-primary" onclick="app.register()">Registrar</button>
                <button class="btn btn-secondary" style="margin-top:10px" onclick="ui.toggleAuthMode('login')">Volver</button>
            </div>

            <div class="auth-options">
                <button class="btn btn-secondary" onclick="app.guestLogin()">Entrar como Invitado</button>
                <button class="btn btn-secondary" id="btn-show-register" onclick="ui.toggleAuthMode('register')">Soy Nuevo</button>
            </div>
        </div>
    </div>

    <div id="view-dashboard" class="view-section container hidden">
        <div class="header-bar">
            <div class="brand">
                <img id="header-logo" src="https://via.placeholder.com/40" alt="Logo">
                <h2 id="header-company-name">Mi Empresa</h2>
            </div>
            <button class="btn-icon" id="btn-settings-nav" onclick="nav.goTo('settings')"><i class="fas fa-cog"></i></button>
        </div>

        <div class="calc-controls">
            <div class="toggle-row">
                <span>Modo de Medida:</span>
                <div style="display:flex; align-items:center; gap:10px;">
                    <span id="lbl-measure-type">M²</span>
                    <label class="switch">
                        <input type="checkbox" id="toggle-measure" onchange="calc.toggleMode()">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div id="inputs-m2">
                <label>Alto (m)</label>
                <input type="number" id="inp-height" inputmode="decimal" placeholder="0.00" oninput="calc.calculate()">
                <label>Ancho (m)</label>
                <input type="number" id="inp-width-m2" inputmode="decimal" placeholder="0.00" oninput="calc.calculate()">
            </div>

            <div id="inputs-ml" class="hidden">
                <label>Metros Lineales</label>
                <input type="number" id="inp-width-ml" inputmode="decimal" placeholder="0.00" oninput="calc.calculate()">
            </div>

            <div class="toggle-row" style="margin-top:15px;">
                <span>Aplicar Descuento</span>
                <label class="switch">
                    <input type="checkbox" id="toggle-discount" onchange="calc.calculate()">
                    <span class="slider"></span>
                </label>
            </div>
            
            <div id="discount-control" class="hidden">
                <label>Porcentaje: <span id="lbl-discount-val">5</span>%</label>
                <input type="range" id="rng-discount" min="5" max="50" step="5" value="5" oninput="document.getElementById('lbl-discount-val').innerText=this.value; calc.calculate()">
            </div>

            <div class="result-box">
                <div class="result-row">
                    <span>Superficie:</span>
                    <span id="res-area">0.00</span>
                </div>
                <div class="result-row">
                    <span>Pintura (L):</span>
                    <span id="res-paint">0.00</span>
                </div>
                <div class="price-total">
                    $<span id="res-price">0</span>
                </div>
            </div>
            
            <br>
            <button class="btn btn-primary" onclick="calc.generateEstimate()">
                <i class="fas fa-file-invoice-dollar"></i> Generar Presupuesto
            </button>
        </div>
        <br><br><br> </div>

    <div id="view-estimate-form" class="view-section container hidden">
        <h3><i class="fas fa-edit"></i> Detalles del Trabajo</h3>
        <br>
        <input type="text" id="est-client" placeholder="Nombre del Cliente / Trabajo (Obligatorio)">
        <input type="text" id="est-address" placeholder="Dirección (Opcional)">
        <input type="tel" id="est-phone" placeholder="Teléfono (Opcional)">

        <h4 style="margin: 15px 0;">Tareas Adicionales</h4>
        <div id="additional-tasks-list">
            </div>
        <button class="btn btn-secondary btn-icon" onclick="est.addTaskRow()" style="margin: 10px auto;">
            <i class="fas fa-plus"></i> Agregar Tarea
        </button>

        <div class="result-box" style="margin-top: 20px;">
             <div class="result-row">
                <span>Base Calculada:</span>
                <span id="est-base-price">$0</span>
            </div>
             <div class="result-row">
                <span>Adicionales:</span>
                <span id="est-extra-price">$0</span>
            </div>
            <hr style="border: 0.5px solid rgba(255,255,255,0.3); margin: 5px 0;">
            <div class="result-row" style="font-size: 1.2rem; font-weight: bold;">
                <span>TOTAL:</span>
                <span id="est-total-final">$0</span>
            </div>
        </div>

        <div style="display:flex; gap:10px; margin-top:20px;">
            <button class="btn btn-danger" onclick="nav.goTo('dashboard')">Cancelar</button>
            <button class="btn btn-primary" id="btn-save-est" onclick="est.saveEstimate()">Guardar</button>
        </div>
    </div>

    <div id="view-history" class="view-section container hidden">
        <h3>Historial de Trabajos</h3>
        <p style="font-size: 0.8rem; color: #777;">Mantén presionado para seleccionar</p>
        <div id="history-container" class="history-list">
            </div>
        
        <div id="selection-bar" class="selection-actions hidden">
            <div onclick="hist.shareWhatsApp()"><i class="fab fa-whatsapp fa-2x" style="color:#25D366"></i></div>
            <div onclick="hist.email()"><i class="fas fa-envelope fa-2x" style="color:#EA4335"></i></div>
            <div onclick="hist.printPDF()"><i class="fas fa-print fa-2x" style="color:#333"></i></div>
            <div onclick="hist.editSingle()"><i class="fas fa-edit fa-2x" style="color:#FBC02D"></i></div>
            <div onclick="hist.deleteSelected()"><i class="fas fa-trash fa-2x" style="color:#ef5350"></i></div>
            <div onclick="hist.clearSelection()"><i class="fas fa-times fa-2x" style="color:#999"></i></div>
        </div>
        <br><br><br>
    </div>

    <div id="view-settings" class="view-section container hidden">
        <h2>Configuración</h2>
        <br>
        
        <div class="settings-group">
            <h3>Mi Cuenta</h3>
            <label>Logo (URL o Base64 - Simulado)</label>
            <input type="file" id="set-logo-file" accept="image/png, image/jpeg" onchange="settings.handleLogoUpload(this)">
            <label>Nombre Empresa</label>
            <input type="text" id="set-company">
            <label>Email Registro</label>
            <input type="email" id="set-email" disabled>
            <label>Dirección</label>
            <input type="text" id="set-address">
            <label>Teléfono</label>
            <input type="tel" id="set-phone">
            <label>Nueva Contraseña</label>
            <input type="password" id="set-password">
        </div>

        <div class="settings-group">
            <h3>Mi Espacio</h3>
            
            <!-- Color de fondo (en versión pastel) -->
            <label>Color de Fondo (Pastel)</label>
            <input type="color" id="set-bg-color" value="#f0f8ff" onchange="settings.updatePreview()">
            
            <!-- Color de acento (detalles) -->
            <label>Color Detalles (Botones, Switches)</label>
            <input type="color" id="set-color-accent" value="#4fc3f7" onchange="settings.updatePreview()">
            
            <!-- Color secundario (bordes, textos) -->
            <label>Color Secundario (Bordes, Textos)</label>
            <input type="color" id="set-secondary-color" value="#0288d1" onchange="settings.updatePreview()">
            
            <label>Tamaño Fuente</label>
            <div style="display:flex; gap:10px; align-items:center;">
                <button class="btn btn-secondary btn-icon" onclick="settings.adjustFont(-1)">-</button>
                <span id="font-size-display">16px</span>
                <button class="btn btn-secondary btn-icon" onclick="settings.adjustFont(1)">+</button>
            </div>
            <div class="toggle-row" style="margin-top:15px;">
                <span>Modo Oscuro</span>
                <label class="switch">
                    <input type="checkbox" id="set-darkmode" onchange="settings.toggleDarkMode()">
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="settings-group">
            <h3>Datos de Cálculo</h3>
            <label>Precio por M² / ML ($)</label>
            <input type="number" id="set-price" inputmode="decimal">
            <label>Rendimiento Pintura (m²/Litro)</label>
            <input type="number" id="set-coverage" inputmode="decimal">
        </div>

        <button class="btn btn-primary" onclick="settings.saveAll()">Guardar Cambios</button>
        <button class="btn btn-danger" style="margin-top:15px;" onclick="app.logout()">Cerrar Sesión</button>
        <br><br><br>
    </div>

    <div id="bottom-nav" class="bottom-nav hidden">
        <div class="nav-item active" onclick="nav.goTo('dashboard')" id="nav-dash">
            <i class="fas fa-calculator"></i> Calc
        </div>
        <div class="nav-item" onclick="nav.goTo('history')" id="nav-hist">
            <i class="fas fa-history"></i> Historial
        </div>
    </div>

    <div id="printable-area">
        </div>

                
                
        <!-- App JS -->
    <script src="app.js"></script>

    <!-- Registro Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js');
        }
    </script>
</body>
</html>
